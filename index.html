<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Invoice/Quotation Generator</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f7fa; margin:0; padding:0;}
.container { max-width: 950px; background: #fff; margin: 30px auto; border-radius: 8px; padding: 30px 32px 37px; box-shadow: 0 4px 24px rgba(0,0,0,0.12);}
h1 { text-align: center; font-weight: bold; margin-bottom: 24px; color: #1f2937;}
.top-row {display:flex;align-items:center;gap:16px;justify-content:flex-end;}
label { font-weight: bold;}
select, input[type=checkbox] {font-size: 15px;}
.tabs { display: flex; justify-content: center; margin-bottom: 21px;}
.tab { cursor: pointer; padding: 12px 34px; font-weight: bold; font-size: 1.15rem; border: 1.5px solid #ccc; border-bottom: none; background: #d3d3d3; color: #444; border-radius: 8px 8px 0 0; margin: 0 10px;}
.tab.active.invoice { background: #0078d7; color: white; border-color: #005ea6;}
.tab.active.quotation { background: #2e8b57; color: white; border-color: #276749;}
.static-details { background:#f3f6fa; border-radius: 7px; padding:14px 20px; margin-bottom:13px; font-size: 15px;}
.row { display: flex; gap: 18px; flex-wrap: wrap; }
.col-half { flex: 1 1 44%; min-width: 240px;}
form label { font-weight: 700; margin: 12px 0 5px 0; display: block; color: #1f2937;}
input, textarea, select { width: 100%; font-size: 15px; padding: 7px 9px; border: 1.2px solid #969696; border-radius: 5px; margin-bottom: 2px; box-sizing: border-box; }
textarea { min-height: 45px; resize: vertical;}
button { margin-top: 16px; font-size: 16px; background: #0078d7; border: none; color: white; font-weight: bold; padding: 10px 20px; border-radius: 5px; cursor: pointer;}
button:hover { background: #005ea6; }
.client-label {margin-top:8px; margin-bottom:2px;}
table { width: 100%; border-collapse: collapse; font-size: 15px; margin-top: 16px; background: white;}
th, td { border: 1.2px solid #bbb; padding: 8px 7px;}
th { background: #f2f6fb; font-weight: bold; text-align: center;}
.desc-cell { padding-top:0 !important; vertical-align:top;}
.desc-cell input { width:100%; font-size:15px; margin-bottom:4px;}
.desc-cell textarea { width:100%; font-size:14px; margin-top:0;}
.right { text-align: right; font-weight: bold;}
.center { text-align: center; }
.removeBtn { background: #e74c3c; color:white; border:none; border-radius: 3px; padding:4px 10px; font-weight: bold;}
.removeBtn:hover { background: #c0392b; }
.summary-table { width: 46%; margin-left: auto; margin-top: 8px; border: 1.2px solid #aaa;}
.summary-table td, .summary-table th { border: 1.2px solid #aaa; text-align: right; padding: 7px 10px;}
.summary-table tr:last-child td { font-size: 1.18em; font-weight: bold;}
.summary-table .right { font-weight: bold;}
@media(max-width:680px){
  .container {padding:5px 1vw;}
  .row { flex-direction: column;}
  .col-half { min-width:unset;}
  .summary-table {width: 100%;}
}
</style>
</head>
<body>
<div class="container">
  <h1>INVOICE & QUOTATION GENERATOR</h1>
  <div class="top-row">
    <label for="bizType" style="font-weight: 700; margin-right:6px;">Business Type:</label>
    <select name="bizType" id="bizType">
      <option value="ravish">RAVISH ENTERPRISE</option>
      <option value="dattatraya">DATTATRAYA NAIK</option>
    </select>
  </div>
  <div class="tabs" role="tablist">
    <div class="tab active invoice" id="tab-invoice" role="tab" tabindex="0" aria-selected="true">Invoice</div>
    <div class="tab quotation" id="tab-quotation" role="tab" tabindex="-1" aria-selected="false">Quotation</div>
  </div>
  <h2 id="documentTitle" style="text-align:center;margin-top:-10px;margin-bottom:19px;font-weight:700;">INVOICE</h2>
  <div class="static-details" id="companyBlock"></div>
  <form id="mainForm" autocomplete="off">
    <div class="row">
      <div class="col-half">
        <label class="client-label" for="invoiceNo">Invoice/Quotation No.</label>
        <input type="text" id="invoiceNo" name="invoiceNo"/>
      </div>
      <div class="col-half">
        <label class="client-label" for="invoiceDate">Date</label>
        <input type="date" id="invoiceDate" name="invoiceDate"/>
      </div>
    </div>
    <h3 style="margin-top:18px;">Client Details</h3>
    <div class="row">
      <div class="col-half">
        <label class="client-label" for="clientName">Client Name</label>
        <input type="text" id="clientName" name="clientName"/>
      </div>
      <div class="col-half">
        <label class="client-label" for="clientGST">Client GST NO</label>
        <input type="text" id="clientGST" name="clientGST"/>
      </div>
    </div>
    <label class="client-label" for="clientAddress">Client Address</label>
    <textarea id="clientAddress" name="clientAddress" rows="2"></textarea>
    <hr style="margin:16px 0 7px 0; border:1px solid #ddd;"/>
    <h3 style="margin-top:0;margin-bottom:3px;">Items</h3>
    <table>
      <thead>
        <tr>
          <th style="width: 6%;">Sr. No.</th>
          <th style="width: 38%;">Description<br><span style="font-weight:400;">Remark below</span></th>
          <th style="width: 12%;">Rate (INR)</th>
          <th style="width: 8%;">Qty</th>
          <th style="width: 18%;">Total Price (INR)</th>
          <th style="width: 4%;"></th>
        </tr>
      </thead>
      <tbody id="itemsBody"></tbody>
    </table>
    <button type="button" id="addItemBtn">Add Item</button>
    <div style="margin-top:20px;max-width:225px;margin-left:auto;">
      <label for="gstSelect" style="font-weight:bold;">Combined GST (CGST+SGST):</label>
      <select id="gstSelect">
        <option value="0">0%</option>
        <option value="5">5%</option>
        <option value="12">12%</option>
        <option value="18" selected>18%</option>
        <option value="28">28%</option>
        <option value="40">40%</option>
      </select>
    </div>
    <textarea id="invoiceRemark" name="invoiceRemark" rows="3" placeholder="Remark"></textarea>
    <div style="margin-top:20px;max-width:250px;margin-left:auto;">
      <label style="font-weight:bold; cursor:pointer;">
        <input type="checkbox" id="toggleBankDetails" checked /> Show Bank Details
      </label>
    </div>
    <div class="static-details" id="bankBlock"></div>
    <table class="summary-table" id="summaryTable">
      <tbody>
        <tr><td>Subtotal</td><td class="right" id="subtotalCell"></td></tr>
        <tr id="cgstRow"><td>CGST (<span id="cgstLabel"></span>%)</td><td class="right" id="cgstCell"></td></tr>
        <tr id="sgstRow"><td>SGST (<span id="sgstLabel"></span>%)</td><td class="right" id="sgstCell"></td></tr>
        <tr><td class="right">TOTAL</td><td class="right" id="totalCell"></td></tr>
      </tbody>
    </table>
    <button type="button" id="generateBtn" style="width:100%; font-size:17px;">Generate & Download PDF</button>
  </form>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script>
const businesses = {
  "ravish": {
    name: "RAVISH ENTERPRISE",
    address: "Shop Number 1, Hanuman Nagar Building, B Wing, Godev Phatak Road, Bhayandar East",
    contact: "9594467193 / 9930933623",
    gst: "27AINPJ0183C1ZG",
    bank: {
      accountName: "RAVISH ENTERPRISE",
      bankName: "KARNATAKA BANK LTD.",
      accountNo: "5232000100099401",
      accountType: "",
      ifsc: "KARB0000523",
      pan: ""
    }
  },
  "dattatraya": {
    name: "DATTATRAYA NAIK",
    address: "C/103 Hanuman Nagar Building, Godev Phatak Rd, Bhayandar East",
    contact: "95944 67193",
    gst: "-",
    bank: {
      accountName: "DATTATRAYA NAIK",
      bankName: "KARNATAKA BANK LTD.",
      accountNo: "5102500100546601",
      accountType: "SAVINGS ACCOUNT",
      ifsc: "KARB0000510",
      pan: "AEOPN0502N"
    }
  }
};
function updateBizFields(){
  let sel = document.getElementById('bizType').value;
  let d = businesses[sel];
  document.getElementById('companyBlock').innerHTML = `<b>${d.name}</b><br>${d.address}<br>Contact: ${d.contact}<br>GST NO: ${d.gst}`;
  const b = d.bank;
  let btxt = `<b>Bank Details</b><br>`;
  btxt += `Account Name: ${b.accountName}<br>`;
  btxt += `Bank Name: ${b.bankName}<br>`;
  btxt += `Account No: ${b.accountNo}<br>`;
  if(b.accountType) btxt += `Account Type: ${b.accountType}<br>`;
  btxt += `IFSC Code: ${b.ifsc}<br>`;
  if(b.pan) btxt += `PAN No.: ${b.pan}<br>`;
  document.getElementById('bankBlock').innerHTML = btxt;
}
updateBizFields();
document.getElementById('bizType').addEventListener('change', ()=>{
  updateBizFields();
});
const tabs = document.querySelectorAll('.tab');
const documentTitle = document.getElementById('documentTitle');
const gstSelect = document.getElementById('gstSelect');
const subtotalCell = document.getElementById('subtotalCell');
const cgstCell = document.getElementById('cgstCell');
const sgstCell = document.getElementById('sgstCell');
const totalCell = document.getElementById('totalCell');
const cgstLabel = document.getElementById('cgstLabel');
const sgstLabel = document.getElementById('sgstLabel');
const cgstRow = document.getElementById('cgstRow');
const sgstRow = document.getElementById('sgstRow');
let mode = 'invoice';
const itemsBody = document.getElementById('itemsBody');
function updateTotalsTable() {
  let subtotal = 0;
  const gstPercent = parseFloat(gstSelect.value) || 0;
  [...itemsBody.children].forEach(tr => {
    const rate = parseFloat(tr.querySelector('.rate').value) || 0;
    const qty = parseInt(tr.querySelector('.qty').value) || 0;
    subtotal += rate * qty;
    tr.querySelector('.totalPrice').textContent = (rate * qty).toFixed(2);
  });
  subtotalCell.textContent = subtotal.toFixed(2);
  if(gstPercent > 0){
    const halfGST = subtotal * (gstPercent/2) / 100;
    cgstRow.style.display = '';
    sgstRow.style.display = '';
    cgstLabel.textContent = (gstPercent/2).toFixed(1);
    sgstLabel.textContent = (gstPercent/2).toFixed(1);
    cgstCell.textContent = halfGST.toFixed(2);
    sgstCell.textContent = halfGST.toFixed(2);
    totalCell.textContent = (subtotal + 2*halfGST).toFixed(2);
  } else {
    cgstRow.style.display = 'none';
    sgstRow.style.display = 'none';
    cgstCell.textContent = '';
    sgstCell.textContent = '';
    totalCell.textContent = subtotal.toFixed(2);
  }
}
function updateSrNumbers() {
  [...itemsBody.children].forEach((tr, i)=>{ tr.children[0].textContent = i+1; });
}
function createItemRow(desc = '', rate = '', qty = '', remark = '') {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td class="center"></td>
    <td class="desc-cell">
      <input type="text" class="desc" style="width:100%;font-size:15px;margin-bottom:6px;" value="${desc}" required />
      <textarea class="remark" style="width:100%;font-size:14px;" rows="2" placeholder="Remark (optional)">${remark}</textarea>
    </td>
    <td><input type="number" class="rate" style="text-align:right;min-width:60px;" value="${rate}" min="0" step="any" required /></td>
    <td><input type="number" class="qty" style="text-align:right;min-width:40px;" value="${qty}" min="0" step="1" required /></td>
    <td class="right totalPrice" style="min-width: 84px;"></td>
    <td class="center"><button type="button" class="removeBtn">X</button></td>
  `;
  itemsBody.appendChild(tr);
  updateSrNumbers();
  function update() { updateTotalsTable(); }
  tr.querySelector('.rate').addEventListener('input', update);
  tr.querySelector('.qty').addEventListener('input', update);
  tr.querySelector('.desc').addEventListener('input', update);
  tr.querySelector('.remark').addEventListener('input', update);
  tr.querySelector('.removeBtn').addEventListener('click', () => {
    tr.remove();
    updateSrNumbers();
    updateTotalsTable();
  });
  update();
}
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => { t.classList.remove('active', 'invoice', 'quotation'); t.setAttribute('aria-selected', 'false'); });
    tab.classList.add('active', tab.id === 'tab-invoice' ? 'invoice':'quotation');
    tab.setAttribute('aria-selected', 'true');
    mode = tab.id === 'tab-invoice' ? 'invoice' : 'quotation';
    documentTitle.textContent = mode.toUpperCase();
    updateTotalsTable();
  });
});
const bankDetailsToggle = document.getElementById('toggleBankDetails');
const bankBlock = document.getElementById('bankBlock');
bankDetailsToggle.addEventListener('change', () => { bankBlock.style.display = bankDetailsToggle.checked ? '' : 'none'; });
bankBlock.style.display = bankDetailsToggle.checked ? '' : 'none';
document.getElementById('addItemBtn').addEventListener('click', () => createItemRow());
gstSelect.addEventListener('change', updateTotalsTable);
itemsBody.innerHTML = '';
createItemRow();
document.getElementById('generateBtn').addEventListener('click', () => {
  const fields = ['invoiceNo', 'invoiceDate', 'clientName'];
  for (const id of fields) if (!document.getElementById(id).value.trim()) {
    alert('Please fill out Invoice/Quotation No, Date, and Client Name.'); return; }
  if (!itemsBody.children.length) { alert('Add at least one item.'); return; }
  for (const tr of itemsBody.children) {
    if (!tr.querySelector('.desc').value.trim() || Number(tr.querySelector('.rate').value) < 0 || Number(tr.querySelector('.qty').value) < 0) {
      alert('Fill out item fields with valid, non-negative numbers.'); return; }
  }
  let subtotal = parseFloat(subtotalCell.textContent) || 0;
  let combinedGSTPercent = parseFloat(gstSelect.value) || 0;
  let cgst = 0, sgst = 0, total = subtotal;
  if (combinedGSTPercent > 0) {
    cgst = subtotal * (combinedGSTPercent/2) / 100;
    sgst = subtotal * (combinedGSTPercent/2) / 100;
    total = subtotal + cgst + sgst;
  }
  const sel = document.getElementById('bizType').value;
  const bz = businesses[sel];
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit:'pt', format:'a4' });
  let y = 38;
  doc.setFontSize(20); doc.setFont('helvetica','bold');
  doc.text(bz.name, 40, y); y += 25;
  doc.setFontSize(13); doc.setFont('helvetica','normal');
  doc.text(mode.toUpperCase(), 40, y); y += 25;
  doc.setFontSize(10);
  doc.text(`No: ${document.getElementById('invoiceNo').value||''}`, 40, y);
  doc.text(`Date: ${document.getElementById('invoiceDate').value||''}`, 170, y); y += 15;
  let companyAddLines = [bz.address, "Contact: " + bz.contact, "GST NO: " + bz.gst];
  for(const line of companyAddLines){ doc.text(line, 40, y); y += 14; }
  let clientY = y;
  doc.setFont('helvetica','bold'); doc.text('TO:', 340, clientY-28);
  doc.setFont('helvetica','normal');
  let ci = document.getElementById('clientName').value || '';
  let ca = document.getElementById('clientAddress').value || '';
  let cg = document.getElementById('clientGST').value || '';
  let caddrLines = [ci];
  if(ca){ caddrLines.push(...doc.splitTextToSize(ca, 200)); }
  if(cg){ caddrLines.push("GST NO: "+cg); }
  let lineStartY = clientY-12;
  for(const l of caddrLines){ doc.text(l, 340, lineStartY); lineStartY += 14; }
  y = Math.max(y, lineStartY) + 6;
  const headers = [["Sr. No.", "Description", "Rate", "Quantity", "Total Price (INR)"]];
  let body = [];
  [...itemsBody.children].forEach((tr,i)=>{
    // Combine description + remark in one cell
    const descText = tr.querySelector('.desc').value;
    const remarkText = tr.querySelector('.remark').value;
    let itemDescPDF = descText;
    if (remarkText.trim()) itemDescPDF += '\n' + remarkText.trim();
    const rRaw = parseFloat(tr.querySelector('.rate').value);
    const r = rRaw.toFixed(2);
    const q = Number(tr.querySelector('.qty').value);
    const t = (r * q).toFixed(2);
    body.push([
      String(i+1), itemDescPDF, r, String(q), {content:t, styles:{fontStyle:'bold'}}
    ]);
  });
  doc.autoTable({
    head: headers, body, startY: y+8, theme: 'grid',
    headStyles: { fillColor: [220,220,220], textColor: 0, fontStyle: 'bold' },
    bodyStyles: { fontSize: 10 },
    columnStyles: {
      0: { cellWidth:36, halign:'center' },
      1: { cellWidth:210 },
      2: { cellWidth:50, halign:'right' },
      3: { cellWidth:40, halign:'right' },
      4: { cellWidth:70, halign:'right', fontStyle:'bold' }
    },
    margin: { left:40, right:40 }, styles: { overflow:'linebreak' }
  });
  let sy = doc.lastAutoTable.finalY;
  const invoiceRemark = document.getElementById('invoiceRemark').value.trim();
  if (invoiceRemark) {
    doc.setFont('helvetica','normal');
    const lines = doc.splitTextToSize(invoiceRemark, doc.internal.pageSize.getWidth() - 80);
    doc.text(lines, 40, sy+18); sy = sy+18 + lines.length*12;
  }
  doc.autoTable({
    body: [
      ["Subtotal", subtotal.toFixed(2)],
      ...(combinedGSTPercent > 0
        ? [
            [`CGST (${(combinedGSTPercent/2).toFixed(1)}%)`, cgst.toFixed(2)],
            [`SGST (${(combinedGSTPercent/2).toFixed(1)}%)`, sgst.toFixed(2)]
          ]
        : []
      ),
      ["TOTAL", total.toFixed(2)]
    ],
    startY: sy+18, theme:'grid', head:[],
    margin: { left: doc.internal.pageSize.getWidth()-220, right:40 },
    tableLineColor: 150, tableLineWidth: 0.5,
    bodyStyles: { fontSize: 10 },
    styles: { cellPadding: 3, overflow:'linebreak' },
    columnStyles: { 0:{cellWidth:110,halign:'left'}, 1:{cellWidth:60,halign:'right',fontStyle:'bold'} }
  });
  let summaryY = doc.lastAutoTable.finalY;
  if(document.getElementById('toggleBankDetails').checked){
    let by = summaryY + 18;
    doc.setFont('helvetica', 'bold');
    doc.text('Bank Details', 40, by);
    by += 15;
    doc.setFont('helvetica', 'normal');
    doc.text('Account Name: ' + bz.bank.accountName, 40, by);
    by += 13;
    doc.text('Bank Name: ' + bz.bank.bankName, 40, by);
    by += 13;
    doc.text('Account No: ' + bz.bank.accountNo, 40, by);
    by += 13;
    if (bz.bank.accountType) {
      doc.text('Account Type: ' + bz.bank.accountType, 40, by);
      by += 13;
    }
    doc.text('IFSC Code: ' + bz.bank.ifsc, 40, by);
    by += 13;
    if (bz.bank.pan) {
      doc.text('PAN No.: ' + bz.bank.pan, 40, by);
    }
  }
  let filename = (mode==='invoice'?'INV':'QT')+"_"+(document.getElementById('invoiceNo').value||'').replace(/[^a-z0-9]/gi,'_')+".pdf";
  doc.save(filename);
});
document.getElementById('mainForm').addEventListener('input', updateTotalsTable);
updateTotalsTable();
</script>
</body>
</html>

